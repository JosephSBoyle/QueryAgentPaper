\documentclass[tikz, border=10pt]{standalone}
\usepackage{tikz}

\usetikzlibrary{
    shapes.geometric, % For cylinder shape
    shapes.clouds,    % For cloud shape
    positioning,      % For placing nodes relative to each other
    arrows.meta,      % For arrow styles
    fit               % To fit shapes around nodes
}

\usepackage{xcolor}
\definecolor{nhsteal}{HTML}{005EB8}      % NHS blue

\begin{document}
\begin{tikzpicture}[
    node distance=2cm,
    % --- STYLES ---
    outerbox/.style={rectangle, draw, thick, rounded corners, minimum width=3.5cm, minimum height=2cm, inner sep=4pt},
    nhs-intranet/.style={
        outerbox,
        minimum height=9cm,
        draw={rgb,255:red,0;green,94;blue,184}, % #005EB8
        thick,
        inner sep=1cm,
    },
    ehs/.style={
        nhs-intranet,
        draw={rgb,255:red,0;green,94;blue,184}, % #005EB8
        thick,
        rounded corners,
        minimum height=4cm,
        minimum width=6cm,
        align=center,
    },
    www-cloud/.style={
        outerbox,
        minimum height=9cm,
        draw=red,
        thick,
        aspect=1.5
        inner sep=1cm,
    },
    % Database cylinders
    database/.style={
        cylinder,
        shape border rotate=90,
        draw,
        fill=blue!10,
        minimum height=1cm,
        minimum width=2.5cm,
        text width=2cm,
        align=center,
        aspect=0.25
    },
    % Rectangular nodes
    box-green/.style={
        draw=green!50!black,
        fill=green!20,
        thick,
        rounded corners,
        minimum height=4cm,
        minimum width=5cm,
        align=center
    },
    agent-box/.style={
        draw=purple!80!black,
        fill=purple!20,
        thick,
        rounded corners,
        minimum height=3cm,
        minimum width=4.8cm,
        align=center
    },
    box-blue/.style={
        draw=blue!80!black,
        fill=blue!20,
        thick,
        rounded corners,
        minimum height=1cm,
        minimum width=2cm,
        align=center,
    },
    % Icon-like node
    icon-node/.style={
        draw=red,
        thick,
        circle,
        minimum size=1.5cm,
        align=center
    },
    % Arrow style
    arrow/.style={
        -{{Stealth[length=3mm]}},
        thick,
        shorten <=2pt,
        shorten >=2pt
    }
]

% --- NODES ---
% Databases at the bottom
\node[database, below left=of ehealth, xshift=-3cm, yshift=-2.7cm] (patient_data)   {Patient Data};
\node[database, below right=of agent, yshift=-2cm]               (concept_db)       {Concepts};

\node[icon-node, left=of patient_data, yshift=6cm, xshift=-3cm] (phc_icon)          {X};
\node[align=center, left=0.2cm of phc_icon, text=red]          (phc_text) {Primary\\Healthcare\\Centre};

\node[icon-node, below left=of phc_icon] (shc_icon) {X};
\node[align=center, below=0.2cm of shc_icon, text=red] (shc_text) {Secondary\\Care};

\node[icon-node, below right=of shc_icon] (ssc_icon) {X};
\node[align=center, below=0.2cm of ssc_icon, text=red] (ssc_text) {Specialist\\Care};

\node[box-blue, right=of ehealth, yshift=0cm, xshift=5cm]   (llm) {LLM\\ Gemini; \\ ChatGPT; \\ Claude};
\node[database, below=of llm]                               (umls) {UMLS};


\node[agent-box] (agent) {\Large \textsc{QueryAgent}};
\node[ehs, fit=(agent) (ehealth) (concept_db), label=eHealthScope] (ehealth) {};


% NHS Intranet
\node[nhs-intranet, fit=(shc_icon) (ssc_icon) (phc_icon) (ehealth) (patient_data) (concept_db) (ehealth),
        label={[color={rgb,255:red,0;green,94;blue,184}, font=\bfseries]above:\Large NHS Intranet}] (nhs_fit) {};

% World Wide Web cloud
\node[www-cloud, fit=(llm) (umls), label={[red, font=\bfseries]:\Large Internet}] (www_fit) {};

% --- LINES & ARROWS ---
% Dashed line separating agent and patient data
% \draw[dashed, very thick, red] (agent.west) -- (agent.west |- ehealth.south);

% Arrows
\draw[arrow] (phc_icon) to[bend left=5] (ehealth.west);
\draw[arrow] (shc_icon) to[bend left=5] (ehealth.west);
\draw[arrow] (ssc_icon) to[bend left=5] (ehealth.west);
\draw[arrow] (agent)    to[bend left=5] (concept_db);
\draw[arrow] (agent)    to[bend left=5] (umls);

\draw[arrow] (agent.east)   to[bend left=5]  (llm.west);
\draw[arrow] (patient_data) to[bend left=5]  (ehealth.west);
\draw[arrow] (agent.west)  to[bend left=20]  (ehealth.west);

% \draw[arrow] (llm.south) to[out=-90, in=0] (concept_db.east);
% \draw[arrow] (concept_db.north east) to[out=45, in=-90, looseness=0.8] (llm.south);

% --- TITLE ---
% \node[above=1.5cm of nhs_fit] (title) {Separation of LLM & ``knowledge'' vs patient data};
% \draw[red, thick] (title.south west) -- (title.south east);

\end{tikzpicture}
\end{document}